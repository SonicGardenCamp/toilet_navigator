<%= render 'layouts/sidebar', toilet_places: @toilet_places%>
<div id='map'></div>

<style>
#map {
  height: 600px;
  width: 600px;
}
</style>

<!-- app/views/some_view.html.erb -->
<script>
let map
let marker

function initMap(){
  const toiletPlaces = [
    <% @toilet_places.each do |toilet_place| %>
      {
        lat: <%= toilet_place.latitude %>,
        lng: <%= toilet_place.longitude %>
      },
    <% end %>
  ];

  map = new google.maps.Map(document.getElementById('map'), {
    center: { lat: toiletPlaces[0].lat, lng: toiletPlaces[0].lng },
    zoom: 12,
  });

  const image = "<%= asset_path('toilet.png') %>";

  toiletPlaces.forEach(place => {
    marker = new google.maps.Marker({
      position: { lat: place.lat, lng: place.lng },
      map: map,
      icon: image,
    });
  });
  
  // 現在地を取得
  navigator.geolocation.getCurrentPosition(function (position) {
  const LatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
  
  // マップの中心に移動
  map.setCenter(LatLng);
  
  // 現在地にマーカーを立てる
    const currentLocationMarker = new google.maps.Marker({
    map: map,
    position: LatLng,
  });

    markers.push(currentLocationMarker);
  }, function(error) {
    console.log("Error occurred. Error code: " + error.code);
  });
}
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap" async defer></script>
